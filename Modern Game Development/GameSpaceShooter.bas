100 COLOR 15,1,1: SCREEN 4,2,0: DEFINT A-Z: REM We use SCREEN 4 for tiles and MSX-2, 2=16*16 sprites, 0=key off
110 GOSUB 2000

150 SPRITE ON: ON SPRITE GOSUB 800

200 X=50: Y=100
210 DIM EX(3), EY(3), EV(3), EW(3)
220 FOR I=0 TO 2
230 EX(I)=EX(I)=I*16
240 EY(I)=-16
250 EV(I)=0: EW(I)=0
260 NEXT I
270 T=0: ES=0

300 ON STICK(0) GOTO 310,320,330,340,350,360,370,380
305 GOTO 400
310 Y=Y-2: GOTO 400
320 Y=Y-2: X=X+2: GOTO 400
330 X=X+2: GOTO 400
340 Y=Y+2: X=X+2: GOTO 400
350 Y=Y+2: GOTO 400
360 Y=Y+2: X=X-2: GOTO 400
370 X=X-2: GOTO 400
380 Y=Y-2: X=X-2
400 IF X<0 THEN X=0
410 IF X>220 THEN X=220
420 IF Y<0 THEN Y=0
430 IF Y>160 THEN Y=160

500 IF STRIG(0) AND BC<>15 THEN BX=X+7: BY=Y-3: BC=15
510 IF BC=15 THEN BY=BY-2: IF BY<0 THEN BX=160: BC=0

600 T=T+1: IF T=90 THEN T=0
610 IF (T MOD 10)=0 THEN IF ES=0 THEN ES=1 ELSE ES=0
620 IF (T MOD 30)<>0 THEN 630
621 EW(T\30)=2
622 EV(T\30)=RND(1)*4-2
623 EY(T\30)=0
624 EX(T\30)=RND(1)*220

630 FOR I=0 TO 2
640 EX(I)=EX(I)+EV(I): EY(I)=EY(I)+EW(I)
650 IF EX(I)<0 THEN EX(I)=0: EV(I)=-EV(I)
660 IF EX(I)>220 THEN EX(I)=220: EV(I)=-EV(I)
670 IF EY(I)>160 THEN EY(I)=-16: EX(I)=I*16: EV(I)=0: EW(I)=0
679 SPRITE OFF
680 PUT SPRITE I,(EX(I),EY(I)),2,ES
681 SPRITE ON
690 NEXT I
691 COLOR SPRITE$(0)=CHR$(2)+CHR$(2)+CHR$(2)+CHR$(2)+CHR$(10)+CHR$(10)+CHR$(10)+CHR$(10)
692 COLOR SPRITE$(1)=CHR$(3)+CHR$(3)+CHR$(3)+CHR$(3)+CHR$(11)+CHR$(11)+CHR$(11)+CHR$(11)

700 SPRITE OFF
701 PUT SPRITE 3,(X,Y),15,2
702 PUT SPRITE 4,(X,Y),4,3
703 PUT SPRITE 5,(BX,BY),BC,4
711 SPRITE ON
770 IF TIME<2 THEN GOTO 770
780 TIME=0
790 GOTO 300

800 SPRITE OFF
810 FOR I=0 TO 3
820 ' check enemy and spaceship
830 IF EX(I)+8>=X AND X+16>=EX(I) AND EY(I)+8>=Y AND Y+16>=EY(I) THEN GOSUB 900
840 ' check enemy and bullet
850 IF EX(I)+8>=BX AND BX+1>=EX(I) AND EY(I)+8>=BY AND BY+3>=EY(I) THEN BX=160: BC=0: EY(I)=-16: EX(I)=I*16: EV(I)=0: EW(I)=0
860 NEXT I
870 RETURN

900 END

1000 DATA 18,3C,7E,DB,FF,24,5A,A5,00,00,00,00,00,00,00,00: REM Sprite enemy
1010 DATA 00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
1020 DATA 18,3C,7E,DB,FF,5A,81,42,00,00,00,00,00,00,00,00: REM Sprite enemy frame 2
1030 DATA 00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
1040 DATA 01,01,01,03,03,02,06,07,0F,0E,1C,3C,7E,F7,E3,C1: REM Sprite ship
1050 DATA 00,00,00,80,80,80,C0,C0,E0,E0,70,78,FC,DE,8E,06
1060 DATA 00,00,00,00,00,01,01,00,00,01,03,03,01,00,00,00: REM Sprite ship color 2
1070 DATA 00,00,00,00,00,00,00,00,00,00,80,80,00,00,00,00
1080 DATA 80,80,80,00,00,00,00,00,00,00,00,00,00,00,00,00: REM Sprite bullet
1090 DATA 00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00
1100 DATA *

2000 S=BASE(9): REM Base 9 = pattern table for sprites
2010 READ R$
2020 IF R$="*" THEN RETURN ELSE VPOKE S,VAL("&H"+R$): S=S+1
2030 GOTO 2010
